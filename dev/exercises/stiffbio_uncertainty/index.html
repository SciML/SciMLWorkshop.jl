<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Investigating Sources of Randomness and Uncertainty in a Stiff Biological System (B) · SciML Workshop</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://docs.sciml.ai/SciMLWorkshop/stable/exercises/stiffbio_uncertainty/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="SciML Workshop logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SciML Workshop</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">SciMLWorkshop: Workshop Materials for Training in Scientific Computing and Scientific Machine Learning (SciML)</a></li><li><span class="tocitem">Exercises</span><ul><li><a class="tocitem" href="../mtk_chemical_reaction/">ModelingToolkit Simple Chemical Reaction ODE (B)</a></li><li class="is-active"><a class="tocitem" href>Investigating Sources of Randomness and Uncertainty in a Stiff Biological System (B)</a><ul class="internal"><li><a class="tocitem" href="#Part-1:-Simulating-the-Oregonator-ODE-model"><span>Part 1: Simulating the Oregonator ODE model</span></a></li><li><a class="tocitem" href="#Part-2:-Investigating-Stiffness"><span>Part 2: Investigating Stiffness</span></a></li><li><a class="tocitem" href="#(Optional)-Part-3:-Specifying-Analytical-Jacobians-(I)"><span>(Optional) Part 3: Specifying Analytical Jacobians (I)</span></a></li><li><a class="tocitem" href="#(Optional)-Part-4:-Automatic-Symbolicification-and-Analytical-Jacobian-Calculations"><span>(Optional) Part 4: Automatic Symbolicification and Analytical Jacobian Calculations</span></a></li><li><a class="tocitem" href="#Part-5:-Adding-stochasticity-with-stochastic-differential-equations"><span>Part 5: Adding stochasticity with stochastic differential equations</span></a></li><li><a class="tocitem" href="#Part-6:-Gillespie-jump-models-of-discrete-stochasticity"><span>Part 6: Gillespie jump models of discrete stochasticity</span></a></li><li><a class="tocitem" href="#Part-7:-Probabilistic-Programming-/-Bayesian-Parameter-Estimation-with-DiffEqBayes.jl-Turing.jl-(I)"><span>Part 7: Probabilistic Programming / Bayesian Parameter Estimation with DiffEqBayes.jl + Turing.jl (I)</span></a></li><li><a class="tocitem" href="#(Optional)-Part-8:-Using-Catalyst&#39;s-Reaction-Network-DSL"><span>(Optional) Part 8: Using Catalyst&#39;s Reaction Network DSL</span></a></li></ul></li><li><a class="tocitem" href="../hybriddelay_pharmacokinetics/">Fitting Hybrid Delay Pharmacokinetic Models with Automated Responses (B)</a></li><li><a class="tocitem" href="../dae_double_pendulum/">Differential-Algebraic Equation Modeling of a Double Pendulum (B)</a></li><li><a class="tocitem" href="../acausal_circuit/">RLC Circuit Acausal Model (I)</a></li><li><a class="tocitem" href="../performance_pde/">Performance Optimizing and Parallelizing Semilinear PDE Solvers (I)</a></li><li><a class="tocitem" href="../gsa_henon_heiles/">Global Parameter Sensitivity and Optimality with GPU and Distributed Ensembles (B)</a></li><li><a class="tocitem" href="../neural_sde/">Training Neural Stochastic Differential Equations with GPU acceleration (I)</a></li><li><a class="tocitem" href="../dc_motor_control/">Controlling a DC Motor (E)</a></li></ul></li><li><span class="tocitem">Selected Solutions</span><ul><li><a class="tocitem" href="../../solutions/mtk_chemical_reaction/">ModelingToolkit Simple Chemical Reaction ODE (B)</a></li><li><a class="tocitem" href="../../solutions/stiffbio_uncertainty/">Investigating Sources of Randomness and Uncertainty in a Stiff Biological System (B)</a></li><li><a class="tocitem" href="../../solutions/hybriddelay_pharmacokinetics/">Fitting Hybrid Delay Pharmacokinetic Models with Automated Responses (B)</a></li><li><a class="tocitem" href="../../solutions/dae_double_pendulum/">Differential-Algebraic Equation Modeling of a Double Pendulum (B)</a></li><li><a class="tocitem" href="../../solutions/acausal_circuit/">RLC Circuit Acausal Model (I)</a></li><li><a class="tocitem" href="../../solutions/performance_pde/">Performance Optimizing and Parallelizing Semilinear PDE Solvers (I)</a></li><li><a class="tocitem" href="../../solutions/gsa_henon_heiles/">Global Parameter Sensitivity and Optimality with GPU and Distributed Ensembles (B)</a></li><li><a class="tocitem" href="../../solutions/neural_sde/">Training Neural Stochastic Differential Equations with GPU acceleration (I)</a></li><li><a class="tocitem" href="../../solutions/dc_motor_control/">Controlling a DC Motor (E)</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Exercises</a></li><li class="is-active"><a href>Investigating Sources of Randomness and Uncertainty in a Stiff Biological System (B)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Investigating Sources of Randomness and Uncertainty in a Stiff Biological System (B)</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/SciMLWorkshop.jl/blob/main/docs/src/exercises/stiffbio_uncertainty.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Investigating-Sources-of-Randomness-and-Uncertainty-in-a-Stiff-Biological-System-(B)"><a class="docs-heading-anchor" href="#Investigating-Sources-of-Randomness-and-Uncertainty-in-a-Stiff-Biological-System-(B)">Investigating Sources of Randomness and Uncertainty in a Stiff Biological System (B)</a><a id="Investigating-Sources-of-Randomness-and-Uncertainty-in-a-Stiff-Biological-System-(B)-1"></a><a class="docs-heading-anchor-permalink" href="#Investigating-Sources-of-Randomness-and-Uncertainty-in-a-Stiff-Biological-System-(B)" title="Permalink"></a></h1><p>In this problem we will walk through the basics of simulating models with DifferentialEquations.jl. Let&#39;s take the <a href="https://www.radford.edu/~thompson/vodef90web/problems/demosnodislin/Demos_Pitagora/DemoOrego/demoorego.pdf">Oregonator model of the Belousov-Zhabotinskii chemical reaction system</a>. This system describes a classical example in non-equilibrium thermodynmics and is a well-known natural chemical oscillator.</p><h2 id="Part-1:-Simulating-the-Oregonator-ODE-model"><a class="docs-heading-anchor" href="#Part-1:-Simulating-the-Oregonator-ODE-model">Part 1: Simulating the Oregonator ODE model</a><a id="Part-1:-Simulating-the-Oregonator-ODE-model-1"></a><a class="docs-heading-anchor-permalink" href="#Part-1:-Simulating-the-Oregonator-ODE-model" title="Permalink"></a></h2><p>When modeling, usually one starts off by investigating the deterministic model. The deterministic ODE formulation of the Oregonator is given by the equations</p><p class="math-container">\[\begin{align*}
\frac{dx}{dt} &amp;= s(y-xy + x - qx^2)\\
\frac{dy}{dt} &amp;= (-y - xy + z)/s\\
\frac{dz}{dt} &amp;= w(x - z)
\end{align*}\]</p><p>with parameter values <span>$s=77.27$</span>, <span>$w=0.161$</span>, and <span>$q=8.375 \times 10^{-6}$</span>, and initial conditions <span>$x(0)=1$</span>, <span>$y(0)=2$</span>, and <span>$z(0)=3$</span>. Use <a href="https://docs.sciml.ai/DiffEqDocs/stable/getting_started/">the tutorial on solving ODEs</a> to solve this differential equation on the timespan of <span>$t\in[0,360]$</span> with the default ODE solver. To investigate the result, plot the solution of all components over time, and plot the phase space plot of the solution (hint: use <code>vars=(1,2,3)</code>). What shape is being drawn in phase space?</p><h2 id="Part-2:-Investigating-Stiffness"><a class="docs-heading-anchor" href="#Part-2:-Investigating-Stiffness">Part 2: Investigating Stiffness</a><a id="Part-2:-Investigating-Stiffness-1"></a><a class="docs-heading-anchor-permalink" href="#Part-2:-Investigating-Stiffness" title="Permalink"></a></h2><p>Because the reaction rates of <code>q</code> vs <code>s</code> is very large, this model has a &quot;fast&quot; system and a &quot;slow&quot; system. This is typical of ODEs which exhibit a property known as stiffness. Stiffness changes the ODE solvers which can handle the equation well. <a href="https://docs.sciml.ai/DiffEqDocs/stable/solvers/ode_solve/">Take a look at the ODE solver page</a> and investigate solving the equation using methods for non-stiff equations (ex: <code>Tsit5</code>) and stiff equations (ex: <code>Rodas5</code>).</p><p>Benchmark using <span>$t\in[0,50]$</span> using <code>@btime</code> from BenchmarkTools.jl. What happens when you increase the timespan?</p><h2 id="(Optional)-Part-3:-Specifying-Analytical-Jacobians-(I)"><a class="docs-heading-anchor" href="#(Optional)-Part-3:-Specifying-Analytical-Jacobians-(I)">(Optional) Part 3: Specifying Analytical Jacobians (I)</a><a id="(Optional)-Part-3:-Specifying-Analytical-Jacobians-(I)-1"></a><a class="docs-heading-anchor-permalink" href="#(Optional)-Part-3:-Specifying-Analytical-Jacobians-(I)" title="Permalink"></a></h2><p>Stiff ODE solvers internally utilize the Jacobian of the ODE system in order to improve the stepsizes in the solution. However, computing and factorizing the Jacobian is costly, and thus it can be beneficial to provide the analytical solution.</p><p>Use the <a href="https://docs.sciml.ai/DiffEqDocs/stable/types/ode_types/#SciMLBase.ODEFunction">ODEFunction definition page</a> to define an <code>ODEFunction</code> which holds both the OREGO ODE and its Jacobian, and solve using <code>Rodas5</code>.</p><h2 id="(Optional)-Part-4:-Automatic-Symbolicification-and-Analytical-Jacobian-Calculations"><a class="docs-heading-anchor" href="#(Optional)-Part-4:-Automatic-Symbolicification-and-Analytical-Jacobian-Calculations">(Optional) Part 4: Automatic Symbolicification and Analytical Jacobian Calculations</a><a id="(Optional)-Part-4:-Automatic-Symbolicification-and-Analytical-Jacobian-Calculations-1"></a><a class="docs-heading-anchor-permalink" href="#(Optional)-Part-4:-Automatic-Symbolicification-and-Analytical-Jacobian-Calculations" title="Permalink"></a></h2><p>Deriving Jacobians by hand is tedious. Thankfully symbolic mathematical systems can do the work for you. And thankfully, DifferentialEquations.jl has tools to automatically convert numerical problems into symbolic problems to perform the analysis on!</p><p>follow the <a href="https://docs.sciml.ai/ModelingToolkit/stable/tutorials/modelingtoolkitize/">ModelingToolkit.jl <code>modelingtoolkitize</code> tutorial</a> to automatically convert your ODE definition to its symbolic form using <code>modelingtoolkitize</code> and calculate the analytical Jacobian. Use the compilation functions to build the <code>ODEFunction</code> with the embedded analytical solution.</p><h2 id="Part-5:-Adding-stochasticity-with-stochastic-differential-equations"><a class="docs-heading-anchor" href="#Part-5:-Adding-stochasticity-with-stochastic-differential-equations">Part 5: Adding stochasticity with stochastic differential equations</a><a id="Part-5:-Adding-stochasticity-with-stochastic-differential-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Part-5:-Adding-stochasticity-with-stochastic-differential-equations" title="Permalink"></a></h2><p>How does this system react in the presense of stochasticity? We can investigate this question by using stochastic differential equations. A stochastic differential equation formulation of this model is known as the multiplicative noise model, is created with:</p><p class="math-container">\[\begin{align*}
dx &amp;= s(y-xy + x - qx^2)dt + \sigma_1 x dW_1\\
dy &amp;= \frac{-y - xy + z}{s}dt + \sigma_2 y dW_2\\
dz &amp;= w(x - z)dt + \sigma_3 z dW_3
\end{align*}\]</p><p>with <span>$\sigma_i = 0.1$</span> where the <code>dW</code> terms describe a Brownian motion, a continuous random process with normally distributed increments. Use the <a href="https://docs.sciml.ai/DiffEqDocs/stable/tutorials/sde_example/">tutorial on solving SDEs</a> to solve simulate this model. Then, <a href="https://docs.sciml.ai/DiffEqDocs/stable/features/ensemble/">use the <code>EnsembleProblem</code></a> to generate and plot 100 trajectories of the stochastic model, and use <code>EnsembleSummary</code> to plot the mean and 5%-95% region over time.</p><p>Try solving with the <code>ImplicitRKMil</code> and <code>SOSRI</code> methods. Notice that it isn&#39;t stiff every single time!</p><p>(For fun, see if you can make the Euler-Maruyama <code>EM()</code> method solve this equation. This requires a choice of <code>dt</code> small enough to be stable. This is the &quot;standard&quot; method!)</p><h2 id="Part-6:-Gillespie-jump-models-of-discrete-stochasticity"><a class="docs-heading-anchor" href="#Part-6:-Gillespie-jump-models-of-discrete-stochasticity">Part 6: Gillespie jump models of discrete stochasticity</a><a id="Part-6:-Gillespie-jump-models-of-discrete-stochasticity-1"></a><a class="docs-heading-anchor-permalink" href="#Part-6:-Gillespie-jump-models-of-discrete-stochasticity" title="Permalink"></a></h2><p>When biological models have very few particles, continuous models no longer make sense, and instead using the full discrete formulation can be required to accuracy describe the dynamics. A discrete differential equation, or Gillespie model, is a continuous-time Markov chain with Poisson-distributed jumps. A discrete description of the Oregonator model is given by a chemical reaction systems:</p><pre><code class="nohighlight hljs">A+Y -&gt; X+P
X+Y -&gt; 2P
A+X -&gt; 2X + 2Z
2X  -&gt; A + P (note: this has rate kX^2!)
B + Z -&gt; Y</code></pre><p>where reactions take place at a rate which is propoertional to its components, i.e. the first reaction has a rate <code>k*A*Y</code> for some <code>k</code>. Use the <a href="https://docs.sciml.ai/JumpProcesses/stable/tutorials/discrete_stochastic_example/">tutorial on Gillespie SSA models</a> to implement the <code>JumpProblem</code> for this model, and use the <code>EnsembleProblem</code> and <code>EnsembleSummary</code> to characterize the stochastic trajectories.</p><p>For what rate constants does the model give the oscillatory dynamics for the ODE approximation? For information on the true reaction rates, consult <a href="https://pubs.acs.org/doi/abs/10.1021/ja00780a001">the original paper</a>.</p><h2 id="Part-7:-Probabilistic-Programming-/-Bayesian-Parameter-Estimation-with-DiffEqBayes.jl-Turing.jl-(I)"><a class="docs-heading-anchor" href="#Part-7:-Probabilistic-Programming-/-Bayesian-Parameter-Estimation-with-DiffEqBayes.jl-Turing.jl-(I)">Part 7: Probabilistic Programming / Bayesian Parameter Estimation with DiffEqBayes.jl + Turing.jl (I)</a><a id="Part-7:-Probabilistic-Programming-/-Bayesian-Parameter-Estimation-with-DiffEqBayes.jl-Turing.jl-(I)-1"></a><a class="docs-heading-anchor-permalink" href="#Part-7:-Probabilistic-Programming-/-Bayesian-Parameter-Estimation-with-DiffEqBayes.jl-Turing.jl-(I)" title="Permalink"></a></h2><p>In many cases, one comes to understand the proper values for their model&#39;s parameters by utilizing data fitting techniques. In this case, we will use the DiffEqBayes.jl library to perform a Bayesian estimation of the parameters. For our data we will the following potential output:</p><pre><code class="language-julia hljs">t = 0.0:1.0:30.0
data = [1.0 2.05224 2.11422 2.1857 2.26827 2.3641 2.47618 2.60869 2.7677 2.96232 3.20711 3.52709 3.97005 4.64319 5.86202 9.29322 536.068 82388.9 57868.4 1.00399 1.00169 1.00117 1.00094 1.00082 1.00075 1.0007 1.00068 1.00066 1.00065 1.00065 1.00065
        2.0 1.9494 1.89645 1.84227 1.78727 1.73178 1.67601 1.62008 1.56402 1.50772 1.45094 1.39322 1.33366 1.2705 1.19958 1.10651 0.57194 0.180316 0.431409 251.774 591.754 857.464 1062.78 1219.05 1335.56 1419.88 1478.22 1515.63 1536.25 1543.45 1539.98
        3.0 2.82065 2.68703 2.58974 2.52405 2.48644 2.47449 2.48686 2.52337 2.58526 2.67563 2.80053 2.9713 3.21051 3.5712 4.23706 12.0266 14868.8 24987.8 23453.4 19202.2 15721.6 12872.0 10538.8 8628.66 7064.73 5784.29 4735.96 3877.66 3174.94 2599.6]</code></pre><p><a href="https://docs.sciml.ai/DiffEqBayes/dev/examples/">Follow the exmaples on the parameter estimation page</a> to perform a Bayesian parameter estimation. What are the most likely parameters for the model given the posterior parameter distributions?</p><p>Use the <code>ODEProblem</code> to perform the fit. If you have time, use the <code>EnsembleProblem</code> of <code>SDEProblem</code>s to perform a fit over averages of the SDE solutions. Note that the SDE fit will take significantly more computational resources! See the GPU parallelism section for details on how to accelerate this.</p><h2 id="(Optional)-Part-8:-Using-Catalyst&#39;s-Reaction-Network-DSL"><a class="docs-heading-anchor" href="#(Optional)-Part-8:-Using-Catalyst&#39;s-Reaction-Network-DSL">(Optional) Part 8: Using Catalyst&#39;s Reaction Network DSL</a><a id="(Optional)-Part-8:-Using-Catalyst&#39;s-Reaction-Network-DSL-1"></a><a class="docs-heading-anchor-permalink" href="#(Optional)-Part-8:-Using-Catalyst&#39;s-Reaction-Network-DSL" title="Permalink"></a></h2><p>Catalyst.jl is a helper library for the DifferentialEquations.jl ecosystem for defining chemical reaction systems at a high leevel for easy simulation in these various forms. Use the descrption <a href="https://docs.sciml.ai/Catalyst/stable/">from the Chemical Reaction Networks documentation page</a> to build a reaction network and generate the ODE/SDE/jump equations, and compare the result to your handcoded versions.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../mtk_chemical_reaction/">« ModelingToolkit Simple Chemical Reaction ODE (B)</a><a class="docs-footer-nextpage" href="../hybriddelay_pharmacokinetics/">Fitting Hybrid Delay Pharmacokinetic Models with Automated Responses (B) »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Tuesday 13 December 2022 11:04">Tuesday 13 December 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
